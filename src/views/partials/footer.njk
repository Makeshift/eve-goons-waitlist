{% block footer %}
    <!-- Legal Notices  Modal -->
    <div role="dialog" tabindex="-1" class="modal fade" id="legal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"><strong class="text-primary">Goon</strong><strong>Incursions</strong></h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                </div>
                <div class="modal-body">
                    <p>EVE Online and the EVE logo are the registered trademarks of CCP hf. All rights are reserved worldwide. All other trademarks are the property of their respective owners. EVE Online, the EVE logo, EVE and all associated logos and designs are the intellectual property of CCP hf. All artwork, screenshots, characters, vehicles, storylines, world facts or other recognizable features of the intellectual property relating to these trademarks are likewise the intellectual property of CCP hf. CCP hf. has granted permission to the Goon Incursions Squad. CCP is in no way responsible for the content on or functioning of this website, nor can it be liable for any damage arising from the use of this website.</p>
                    <ul class="list-unstyled text-center">
                        <li><small>Design by <a href="#">Caitlin  Viliana</a>, theme by: <a href="https://bootstrapious.com">Bootstrapious</a></small></li>
                        <li><small>Website developed and maintained by: <a href="#">Makeshift Storque</a></small></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Javascript files-->
    <script src="/includes/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="/includes/vendor/jquery.cookie/jquery.cookie.js"> </script>
    <script src="/includes/vendor/chart.js/Chart.min.js"></script>
    <!--<script src="/includes/js/charts-home.js"></script>-->
    <script src="/includes/js/front.js"></script>
    <script>
        //Page Load
        $(document).ready(function() {
            poll();
        });
        
        //Tooltips
        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })

        //Inform user that they don't get notifications.
        $(document).ready(function () {
            if (Notify.needsPermission && Notify.isSupported()) {
                var noNotify = `<div role="alert" id="noNotify" class="alert alert-primary global-banner-inactive">
                <i class="fas fa-bell-slash"></i> Notifications disabled: this means you may miss your invite. Click <span style="text-decoration:underline" onclick="enableNotifications()">HERE</span> to enable them.
              </div>`
                $( "#alertarea" ).prepend( noNotify );
            }
           
        })
        
        //Enable Notifications at users request
        function enableNotifications() {
             if (!Notify.needsPermission) {
                console.log("allowed");
            } else if (Notify.isSupported()) {
                Notify.requestPermission(enableNotificationsGranted, enableNotificationsDenied);
            }

            function enableNotificationsGranted() {
                console.log('Permission has been granted by the user');
                $( "#noNotify" ).hide();
            }
            
            function enableNotificationsDenied() {
                console.warn('Permission has been denied by the user');
            }
        }

        //Longpoll for Notifications
        var poll = function () {
            $.ajax({
            url: "/poll/{{userProfile.characterID}}",
            success: function(data){
                if (!Notify.needsPermission) {
                    showNotification(data);
                }
                //repoll
                poll();
            },
            error: function() {
                poll();
            },
            timeout: 30000 // 30 seconds
            });
        };

        function showNotification(payload) {
            console.log(payload.data);
            var cNotification = new Notify(payload.data.appName, {
                    body: payload.data.message,
                    icon: payload.data.imgUrl,
                    tag: payload.data.target.id,
                    timeout: 30,
                    notifyClick: cClick,
                    notifyShow: cShow
                });

                cNotification.show();
                
                function cShow() {
                    var audio = new Audio(payload.data.sound);
                    audio.play();
                }
                function cClick() {
                    window.location.assign(payload.data.comms.url);
                }
        }

        //Pilot, Corp, Alliance showinfo
        function showInfo(targetID) {
            $.ajax({
              type: "POST",
              url: "/esi/ui/info/"+targetID
            });
        }

        //Sets a waypoint
        function setWaypoint(systemID) {
              $.ajax({
                type: "POST",
                url: "/esi/ui/waypoint/"+systemID
        });
    }
    </script>
  </body>
</html>
{% endblock %}